{% extends 'base.html' %}
{% load staticfiles %}
{% load in_category %}
{% load carton_tags %}
{% get_cart as cart %}

{% block title %}IRK SHOP{% endblock %}
{% block css %}
    <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}" xmlns="http://www.w3.org/1999/html">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fullPage.js/2.8.7/jquery.fullPage.min.css">
    <link rel="stylesheet" href="{% static 'css/bootstrap-social.css' %}">
    <!--<link rel="stylesheet" href="{% static 'css/iziModal.min.css' %}"> -->
    <link rel="stylesheet" href="{% static 'css/main.css' %}">
{% endblock %}
{% block body %}
    <div>
        {% include 'compositions/sidebar.html' %}
        <main>
            <a href="{% url 'shop:shopping-cart-show' %}"><img id="shopping-cart-icon" src="{% static 'image/shopping_cart.png' %}"></a>
            <div id="fullpage">
                {% for category in categories %}
                    <div class="section" id="{{ category }}">
                        {% for good in goods|in_category:category %}
                            {% if good|is_available %}
                                <div class="slide">
                                    <div class="box"
                                         style='background-image: url("{{ good.get_first_image.image.url }}");'>
                                        <div class="shadow-box">
                                            <div class="blank-box"></div>
                                            <div class="addCartButton-push">
                                                <img class="btn btn-xs addCartButton" name="submit"
                                                     src="{% static 'image/cart.png' %}">
                                                <h5>ADD TO CART</h5>
                                            </div>
                                            <form id="add{{ good.name|safe }}" class="addCart" method="POST"
                                                  enctype="multipart/form-data">
                                                {% csrf_token %}
                                                <h2><strong>{{ good.name }}</strong></h2>
                                                <h4><u>Price: ${{ good.price }}</u></h4>
                                                <p>{{ good.description|safe }}</p>
                                                <input name="good" value="{{ good.pk }}" type="hidden">
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            {% endif %}
                        {% endfor %}
                    </div>
                {% endfor %}
            </div>
        </main>
    </div>
{#    <!-- Modal -->#}
{#    <div id="shoppingCart" class="modal fade" role="dialog" style="z-index: 99999999 !important; background: white">#}
{#        <span class="close">&times;</span>#}
{#        <div class="modal-dialog modal-lg">#}
{#            <!-- Modal content-->#}
{#            <div class="modal-content">#}
{#                <div class="modal-body">#}
{#                    <iframe frameborder="0" id="shoppingCartHTML"></iframe>#}
{#                </div>#}
{#                <div class="modal-footer">#}
{#                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>#}
{#                </div>#}
{#            </div>#}
{##}
{#        </div>#}
{#    </div>#}
{% endblock %}

{% block js %}
    <script type="text/javascript"
            src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.9.1/jquery-ui.min.js"></script>
    <script src="{% static 'js/jquery.fullPage.min.js' %}"></script>
    <script src="{% static 'js/jquery.fullpage.extensions.min.js' %}"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fullPage.js/2.8.7/vendors/scrolloverflow.min.js"></script>
    <script src="{% static 'js/iziModal.min.js' %}"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $('#fullpage').fullpage({
                anchors: {{ categories_list|safe }},
                css3: true,
                navigation: true,
                navigationPosition: 'right',
                slidesToSections: true,
                slidesNavigation: true,
                loopHorizontal: false,
                controlArrows: true,
                onSlideLeave: function (anchorLink, index, slideIndex, direction, nextSlideIndex) {
                    $('.slider_prev').removeClass('slider_prev');
                    $('.slider_next').removeClass('slider_next')
                    var slides = $('div.active').children('.fp-slides')[0].children[0].children.length
                    console.log(slides)
                },
                afterSlideLoad: function (anchorLink, index, slideAnchor, slideIndex) {
                    var slides = $('div.active').children('.fp-slides')[0].children[0].children.length
                    console.log(slides)
                    if (length > 1) {
                        $('.fp-slide.active').next('.fp-slide').addClass('slider_next');
                        $('.fp-slide.active').prev('.fp-slide').addClass('slider_prev');
                    }
                }
            });

            $('.fp-slide.active').next('.fp-slide').addClass('slider_next');
            $('.fp-slide.active').prev('.fp-slide').addClass('slider_prev');
            $('#toggleHeader').click(function () {
                $('#header').toggleClass('open');
            })
            $('#fullpage').click(function () {
                $('#header').removeClass('open');
            })
            $('img.addCartButton').on('click touchstart', function () {
                var form = $(this).parent().next('form').serialize()
                $.ajax({
                    url: "{% url 'shop:shopping-cart-add' %}",
                    type: "POST",
                    data: form,
                    success: function (json) {
                        console.log(json); // another sanity check
                        alert(json['message']);
                    }
                })
            });
        });
    </script>

{#    <script>#}
{#        // Get the modal#}
{#        var modal = document.getElementById('shoppingCart');#}
{##}
{#        // Get the image and insert it inside the modal - use its "alt" text as a caption#}
{#        var shoppingCartBtn = document.getElementById('shopping-cart-icon');#}
{#        shoppingCartBtn.onclick = function () {#}
{#            modal.style.display = "block";#}
{#            $.ajax({#}
{#                url: "{% url 'shop:shopping-cart-show' %}",#}
{#                type: "GET",#}
{#                success: function (html) {#}
{#                    document.querySelector('#shoppingCartHTML').innerHTML = html#}
{#                }#}
{#            })#}
{#        }#}
{#        // Get the <span> element that closes the modal#}
{#        var span = document.getElementsByClassName("close")[0];#}
{#        // When the user clicks on <span> (x), close the modal#}
{#        span.addEventListener('click', function () {#}
{#            modal.style.display = "none";#}
{#        })#}
{#    </script>#}
{% endblock %}